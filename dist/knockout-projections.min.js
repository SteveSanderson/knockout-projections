/*! Knockout projections plugin - version 1.1.0
------------------------------------------------------------------------------
Copyright (c) Microsoft Corporation
All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABLITY OR NON-INFRINGEMENT.
See the Apache Version 2.0 License for specific language governing permissions and limitations under the License.
------------------------------------------------------------------------------
*/
!function(a,b){"use strict";function c(a,b,c,d,e,f,g){this.inputItem=b,this.stateArrayIndex=c,this.mappingOptions=e,this.arrayOfState=f,this.outputObservableArray=g,this.outputArray=this.outputObservableArray.peek(),this.isIncluded=null,this.suppressNotification=!1,this.outputArrayIndex=a.observable(d),this.disposeFuncFromMostRecentMapping=null,this.mappedValueComputed=a.computed(this.mappingEvaluator,this),this.mappedValueComputed.subscribe(this.onMappingResultChanged,this),this.previousMappedValue=this.mappedValueComputed.peek()}function d(a,b){if(!a)return null;switch(a.status){case"added":return a.index;case"deleted":return a.index+b;default:throw new Error("Unknown diff status: "+a.status)}}function e(a,b,d,e,f,g,h,i,j){var k="number"==typeof b.moved,l=k?d[b.moved]:new c(a,b.value,e,f,g,h,i);return h.splice(e,0,l),l.isIncluded&&j.splice(f,0,l.mappedValueComputed.peek()),k&&(l.stateArrayIndex=e,l.setOutputArrayIndexSilently(f)),l}function f(a,b,c,d,e){var f=b.splice(c,1)[0];f.isIncluded&&e.splice(d,1),"number"!=typeof a.moved&&f.dispose()}function g(a,b,c){return a.stateArrayIndex=b,a.setOutputArrayIndexSilently(c),c+(a.isIncluded?1:0)}function h(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d];"added"===e.status&&"number"==typeof e.moved&&(c[e.moved]=b[e.moved])}return c}function i(a,b,c){return c.length&&b[a.index]?b[a.index].outputArrayIndex.peek():c.length}function j(a,b,c,j,k,l){return b.subscribe(function(b){if(b.length){for(var m=h(b,c),n=0,o=b[0],p=0,q=o&&i(o,c,j),r=o.index;o||r<c.length;r++)if(d(o,p)===r){switch(o.status){case"added":var s=e(a,o,m,r,q,l,c,k,j);s.isIncluded&&q++,p++;break;case"deleted":f(o,c,r,q,j),p--,r--;break;default:throw new Error("Unknown diff status: "+o.status)}n++,o=b[n]}else r<c.length&&(q=g(c[r],r,q));k.valueHasMutated()}},null,"arrayChange")}function k(a,b){var d=this,e=[],f=[],g=a.observableArray(f),h=d.peek();if("function"==typeof b&&(b={mapping:b}),b.mappingWithDisposeCallback){if(b.mapping||b.disposeItem)throw new Error("'mappingWithDisposeCallback' cannot be used in conjunction with 'mapping' or 'disposeItem'.")}else if(!b.mapping)throw new Error("Specify either 'mapping' or 'mappingWithDisposeCallback'.");for(var i=0;i<h.length;i++){var k=h[i],l=new c(a,k,i,f.length,b,e,g),m=l.mappedValueComputed.peek();e.push(l),l.isIncluded&&f.push(m)}var o=j(a,d,e,f,g,b),p=a.computed(g).extend({trackArrayChanges:!0}),q=p.dispose;return p.dispose=function(){o.dispose(),a.utils.arrayForEach(e,function(a){a.dispose()}),q.call(this,arguments)},n(a,p),p}function l(a,b){return k.call(this,a,function(a){return b(a)?a:q})}function m(a){function b(a,b){return function(){return b.apply(this,[a].concat(Array.prototype.slice.call(arguments,0)))}}a[r]={map:b(a,k),filter:b(a,l)}}function n(a,b){return a.utils.extend(b,a[r]),b}function o(a){a.projections={_exclusionMarker:q},m(a),n(a,a.observableArray.fn)}function p(){if("function"==typeof define&&define.amd)define(["knockout"],o);else if("undefined"!=typeof module&&"undefined"!=typeof module.exports){var b=require("knockout");o(b),module.exports=b}else"ko"in a&&o(a.ko)}var q={};c.prototype.dispose=function(){this.mappedValueComputed.dispose(),this.disposeResultFromMostRecentEvaluation()},c.prototype.disposeResultFromMostRecentEvaluation=function(){if(this.disposeFuncFromMostRecentMapping&&(this.disposeFuncFromMostRecentMapping(),this.disposeFuncFromMostRecentMapping=null),this.mappingOptions.disposeItem){var a=this.mappedValueComputed();this.mappingOptions.disposeItem(a)}},c.prototype.mappingEvaluator=function(){null!==this.isIncluded&&this.disposeResultFromMostRecentEvaluation();var a;if(this.mappingOptions.mapping)a=this.mappingOptions.mapping(this.inputItem,this.outputArrayIndex);else{if(!this.mappingOptions.mappingWithDisposeCallback)throw new Error("No mapping callback given.");var b=this.mappingOptions.mappingWithDisposeCallback(this.inputItem,this.outputArrayIndex);if(!("mappedValue"in b))throw new Error("Return value from mappingWithDisposeCallback should have a 'mappedItem' property.");a=b.mappedValue,this.disposeFuncFromMostRecentMapping=b.dispose}var c=a!==q;return this.isIncluded!==c&&(null!==this.isIncluded&&this.moveSubsequentItemsBecauseInclusionStateChanged(c),this.isIncluded=c),a},c.prototype.onMappingResultChanged=function(a){a!==this.previousMappedValue&&(this.isIncluded&&this.outputArray.splice(this.outputArrayIndex.peek(),1,a),this.suppressNotification||this.outputObservableArray.valueHasMutated(),this.previousMappedValue=a)},c.prototype.moveSubsequentItemsBecauseInclusionStateChanged=function(a){var b,c,d=this.outputArrayIndex.peek();if(a)for(this.outputArray.splice(d,0,null),b=this.stateArrayIndex+1;b<this.arrayOfState.length;b++)c=this.arrayOfState[b],c.setOutputArrayIndexSilently(c.outputArrayIndex.peek()+1);else for(this.outputArray.splice(d,1),b=this.stateArrayIndex+1;b<this.arrayOfState.length;b++)c=this.arrayOfState[b],c.setOutputArrayIndexSilently(c.outputArrayIndex.peek()-1)},c.prototype.setOutputArrayIndexSilently=function(a){this.suppressNotification=!0,this.outputArrayIndex(a),this.suppressNotification=!1};var r="_ko.projections.cache";p()}(this);